@page "/Sistemas/Create"
@inject SistemasService sistemasService
@inject NavigationManager navigation


<h3>Create</h3>

@code {
    public Sistemas nuevoSistema = new Sistemas();
    [Inject] protected ToastService ToastService { get; set; }
    public List<Sistemas> Sistemas { get; set; } = new List<Sistemas>();

    protected override async Task OnInitializedAsync()
    {
        Sistemas = await sistemasService.Listar(c => c.SistemaId > 0);
    }

    public async Task<bool> Validar()
    {
        var descripcionDuplicada = await sistemasService.BuscarDescripcion(nuevoSistema.Descripcion);
        if (descripcionDuplicada != null)
        {
            ToastService.Notify(new(ToastType.Warning, "El nombre del técnico ya está registrado", " Por favor, utiliza un nombre diferente."));

            return false;
        }

        return true;
    }

    public async Task GuardarSistema()
    {
        if (await Validar())
        {
            ToastService.Notify(new(ToastType.Primary, "Sistema registrado exitosamente.", "Se ha guardado el Sistema."));
            await sistemasService.Guardar(nuevoSistema);
            await Task.Delay(4000);
            nuevoSistema = new Sistemas();
            navigation.NavigateTo("/Sistemas/Index");
        }
    }
}
